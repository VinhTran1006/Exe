using Microsoft.EntityFrameworkCore;
using Agriculture_Analyst.Models;

namespace Agriculture_Analyst.Data
{
 public class ApplicationDbContext : DbContext
 {
 public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
 : base(options)
 {
 }

 public DbSet<User> Users { get; set; } = null!;
 public DbSet<Role> Roles { get; set; } = null!;
 public DbSet<UserRole> UserRoles { get; set; } = null!;

 protected override void OnModelCreating(ModelBuilder modelBuilder)
 {
 base.OnModelCreating(modelBuilder);

 modelBuilder.Entity<User>(entity =>
 {
 entity.HasKey(e => e.UserId);
 entity.Property(e => e.Username).IsRequired();
 entity.Property(e => e.Name).IsRequired();
 entity.Property(e => e.Email).IsRequired();
 });

 modelBuilder.Entity<Role>(entity =>
 {
 entity.HasKey(e => e.RoleId);
 entity.Property(e => e.Name).IsRequired();
 });

 modelBuilder.Entity<UserRole>(entity =>
 {
 entity.HasKey(e => new { e.UserId, e.RoleId });

 entity.HasOne(ur => ur.User)
 .WithMany(u => u.UserRoles)
 .HasForeignKey(ur => ur.UserId);

 entity.HasOne(ur => ur.Role)
 .WithMany(r => r.UserRoles)
 .HasForeignKey(ur => ur.RoleId);
 });
 }
 }
}
